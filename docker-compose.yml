version: '3.8'

services:
  fl-crew-reddit:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fl-crew-reddit
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}
      - AWS_S3_BUCKET=${AWS_S3_BUCKET}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET}
      - REDDIT_USER_AGENT=${REDDIT_USER_AGENT}
      - BASE_LLM_MODEL=${BASE_LLM_MODEL:-mistralai/Mistral-7B-v0.1}
      - AGENT_LLM_MODEL=${AGENT_LLM_MODEL:-gpt-4}
      - USE_S3_STORAGE=${USE_S3_STORAGE:-true}
    volumes:
      - ./fl_crew_reddit:/app/fl_crew_reddit
      - ./data:/app/data
      - ./models:/app/models
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: python -m fl_crew_reddit.main

  reddit-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: reddit-mcp-server
    environment:
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET}
      - REDDIT_USER_AGENT=${REDDIT_USER_AGENT}
      - REDDIT_DATA_DIR=/app/data/reddit_data
    volumes:
      - ./reddit_server:/app/reddit_server
      - ./data/reddit_data:/app/data/reddit_data
    command: python -m reddit_server.server

networks:
  default:
    name: fl-crew-network

